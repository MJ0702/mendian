!function(t,e){"function"==typeof define&&define.amd?define(e):"object"==typeof exports?exports=module.exports=e():t.PlanCalendar=e()}(this?this:window,function(){function t(t){return t>=10?t:"0"+t}function e(e,n){const i="date"===a(e)?e:new Date(e),s=n||"yyyy/mm/dd",l=i.getFullYear(),o=t(i.getMonth()+1),r=t(i.getDate()),c=s.match(/[-\/\s年月日]/g);return`${l}${c[0]}${o}${c[1]}${r}${c[2]?c[2]:""}`}function a(t){const e=Object.prototype.toString;return"[object Array]"===e.call(t)?"array":"[object Object]"===e.call(t)?"object":"[object Date]"===e.call(t)?"date":void 0}function n(t,e){return t.className.includes(e)}function i(t,e){n(t,e)||(t.className+=" "+e)}function s(t,e){if(n(t,e)){const a=new RegExp(`(\\s|^)${e}`);t.className=t.className.replace(a,"")}}return class{constructor(t,n){this.$el=1===t.nodeType?t:document.querySelector(t),this.$options=function t(e,n){for(let i in e)void 0===n[i]?n[i]=e[i]:"object"===a(n[i])&&t(e[i],n[i]);return n}({monthNum:4,startByData:!1,showExpiredData:!1,minPriceText:"无团期",sellOutText:"售罄",maxNum:20,maxNumText:"充足",defineNumText:"",markDates:[],disableDates:[],onSelect:function(t,e){},onMouseEnter:function(t,e){},onMouseLeave:function(){},onMonthChange:function(t,e,a){},initTips:function(t){}},n),this.$data=this.optimizeData(),this.$options.startByData=this.$options.startByData&&!this.$options.showExpiredData,this.$startDate=this.$data.length>0?this.$data[0].date:e(new Date),this.$selectedDate="",this.initCalendar()}reload(){this.$el.innerHTML="",this.$selectedDate="",this.initCalendar()}optimizeData(){const t=new Date,a=new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime(),n=this.$options.markDates.reduce((t,a)=>(a.date=e(new Date(a.date)),t.push(a),t),[]).sort((t,e)=>new Date(t.date).getTime()-new Date(e.date).getTime());return this.$options.showExpiredData?n:n.filter(t=>""==this.$options.start_date?a<=new Date(t.date).getTime():a)}initCalendar(){const t=this.$options;let e=t.startByData?+this.$startDate.split("/")[0]:(new Date).getFullYear(),a=t.startByData?+this.$startDate.split("/")[1]-1:(new Date).getMonth(),n=0;const l=this.createElem("span","calendar-btn-prev","&lt;"),o=this.createElem("span","calendar-btn-next","&gt;"),r=this.createElem("ul","calendar-month",this.getCalMonthHtml(e,a,n));this.createElem("ul","calendar-week",this.getCalWeek());const c=this.createElem("ul","calendar-date",this.getCalDateHtml(e,a));t.onMonthChange(e,a,this.getMonthData(e,a)),this.on("click",r,"li",(l,o)=>{l.childNodes.forEach(t=>s(t,"active")),i(o,"active");for(let t=0;t<l.childNodes.length;t++)if(l.childNodes[t]===o){n=t;break}e=+o.getAttribute("data-year"),a=+o.getAttribute("data-month")-1,c.innerHTML=this.getCalDateHtml(e,a),t.onMonthChange(e,a,this.getMonthData(e,a))}),this.on("click",c,".enabled",(e,a)=>{if(e.childNodes.forEach(t=>s(t,"selected")),i(a,"selected"),this.$selectedDate=a.getAttribute("data-date"),t.onSelect(a,this.getPlanDateData(this.$selectedDate)),a.className.includes("prev")){if(0===n)return l.click(),!1;r.childNodes[n].previousSibling.click()}if(a.className.includes("next")){if(n===t.monthNum-1)return o.click(),!1;r.childNodes[n].nextSibling.click()}}),this.on("mouseover",c,".enabled",(e,a,n)=>{const i=a.getAttribute("data-date");n===a||a.contains(n)||"enabled"!==a.className.trim()&&!a.className.includes("selected")||t.onMouseEnter(this.getPlanDateData(i),a)}),this.on("mouseout",c,".enabled",(e,a,n)=>{n===a||a.contains(n)||"enabled"!==a.className.trim()&&!a.className.includes("selected")||t.onMouseLeave()}),l.addEventListener("click",()=>{e=0===a?--e:e,a=0===a?11:--a,0===n?(n=0,r.innerHTML=this.getCalMonthHtml(e,a,n),c.innerHTML=this.getCalDateHtml(e,a)):r.childNodes[n].previousSibling.click(),t.onMonthChange(e,a,this.getMonthData(e,a))}),o.addEventListener("click",()=>{e=11===a?++e:e,a=11===a?0:++a,n===t.monthNum-1?(n=0,r.innerHTML=this.getCalMonthHtml(e,a,n),c.innerHTML=this.getCalDateHtml(e,a)):r.childNodes[n].nextSibling.click(),t.onMonthChange(e,a,this.getMonthData(e,a))})}on(t,e,a,n){e.addEventListener(t,function(t){const e=function t(e,a,n){return"BODY"===e.parentNode.nodeName?null:e.parentNode===a?e.nodeName.toLowerCase()===n||e.className.includes(n.substring(1))||e.id.includes(n.substring(1))?e:null:e.parentNode!==a?t(e.parentNode,a,n):null}(t.target||t.srcElement,this,a),i=t.relatedTarget;e&&n&&n(this,e,i)})}createElem(t,e,a){const n=document.createElement(t);return n.className=e,n.innerHTML=a,this.$el.append(n),n}getPlanDate(t,a,n){this.$options;const i=this.getUniqueData();var s={};for(let o=0;o<i.length;o++){var l="";if(null!==i[o].color_tag){(s=JSON.parse(i[o].color_tag)).length>2&&(s.length=s.length-1);for(let t=0;t<s.length;t++)l+='<p class="plan_color_commom plan_color_data_'+s[t].color_num+'">'+s[t].tag_name+"</p>";l='<div class="plan_color_box">'+l+"</div>"}if(e(new Date(t,a,n))===i[o].date)return`${this.getPlanDateData(t,a,n).length>1?'<i class="badge">多团</i>':l}\n                      <p class="price">&yen;${i[o].price}起</p>\n                      <p class="number">${this.toNumText(i[o].number)}</p>`}}getUniqueData(t){const e=[],a=this.$data.sort((t,e)=>t.price-e.price).reduce((t,a)=>(-1===e.indexOf(a.date)&&(t.push(a),e.push(a.date)),t),[]);return"date"===t?e:a}getPlanDateData(...t){const a=1===t.length?e(new Date(t[0])):e(new Date(t[0],t[1],t[2]));return this.$data.filter(t=>t.date===a).sort((t,e)=>t.price-e.price)}getCalDateData(t,a){const n=[31,t%4==0&&t%100!=0||t%400==0?29:28,31,30,31,30,31,31,30,31,30,31],i=new Date(t,a,1).getDay(),s=i+(n[a]-1),l=((t=0)=>()=>++t)(),o=[];for(let r=0;r<42;r++)if(r<i){let s=0===a?11:a-1,l=e(new Date(0===a?t-1:t,s,n[s]-(i-1-r)));o.push({date:l,status:"prev"})}else if(r>=i&&r<=s){let n=e(new Date(t,a,r-i+1));o.push({date:n,status:"current"})}else{let n=e(new Date(11===a?t+1:t,11===a?0:a+1,l()));o.push({date:n,status:"next"})}return o}getCalDateHtml(t,e){new Date;let a="";this.$options;const n=this.getCalDateData(t,e);this.getUniqueData("date");for(let t=0;t<n.length;t++)"prev"===n[t].status?a+=this.getPlanDateHtml(n[t].date,"prev"):"current"===n[t].status?a+=this.getPlanDateHtml(n[t].date,"current"):"next"===n[t].status&&(a+=this.getPlanDateHtml(n[t].date,"next"));return a}getPlanDateHtml(t,e){const a=this.getUniqueData("date"),n=+t.split("/")[0],i=+t.split("/")[1]-1,s=+t.split("/")[2],l=new Date(t).getDay(),o=this.isToday(n,i,s),r=this.isDisabled(t)?"disabled":"enabled",c=this.$selectedDate===t?"selected":"",d="current"!==e?`invalid ${e}`:"",h="今天"===o?"today":"";return-1!==a.indexOf(t)?`<li class="${r} ${c} ${d} ${h}" data-date="${t}" data-week="${l}">\n            <p class="date">${o}</p>\n            ${this.getPlanDate(n,i,s)}\n          </li>`:`<li class="${d} ${h}" data-date="${t}" data-week="${l}"><p class="date">${o}</p></li>`}getCalMonthHtml(t,e,a){let n="",i=t,s=e;for(let l=0;l<this.$options.monthNum;l++){s=e+l,e+l>11&&(i=t+1,s=e+l-12);let o=this.getMinPrice(i,s),r=o===this.$options.minPriceText?o:`&yen;${o}起`;n+=`<li data-year="${i}" data-month="${s+1}" class="item \n          ${l===a?"active":""}">\n          <p class="month">${i}年${s+1}月</p>\n          <p class="${o===this.$options.minPriceText?"none":"price"}">${r}</p>\n        </li>`}return n}getCalWeek(){const t=["日","一","二","三","四","五","六"];let e="";for(let a=0;a<t.length;a++)e+=`<li>${t[a]}</li>`;return e}getMonthData(t,e){return 0===this.$data.length?this.$data:this.$data.filter(a=>+a.date.split("/")[0]===t&&+a.date.split("/")[1]===e+1).sort((t,e)=>new Date(t.date).getTime()-new Date(e.date).getTime())}toNumText(t){const e=this.$options;return e.defineNumText?e.defineNumText:-1==e.maxNum?"余："+t:t<9?e.thenLessMaxNumText:e.maxNumText}isDisabled(t){const n=this.$options.disableDates;if("array"===a(n))return 0!==n.length&&-1!==n.map(t=>e(t)).indexOf(t);{const a=new Date(t).getTime(),i=n.start?new Date(e(n.start)).getTime():(new Date).getTime(),s=n.end?new Date(e(n.end)).getTime():(new Date).getTime();return!(s-i<=0)&&a>=i&&a<=s}}getMinPrice(t,e,a){if(a)return this.getPlanDateData(t,e,a)[0];if(0===this.$data.length)return this.$options.minPriceText;const n=this.$data.filter(a=>+a.date.split("/")[0]===t&&+a.date.split("/")[1]===e+1);return 0!==n.length?n.map(t=>t.price).sort((t,e)=>t-e)[0]:this.$options.minPriceText}getStart(t){const e=new Date;new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime(),this.$options.startByData}isToday(t,e,a){const n=new Date;return new Date(t,e,a).getTime()===new Date(n.getFullYear(),n.getMonth(),n.getDate()).getTime()?"今天":a}}});